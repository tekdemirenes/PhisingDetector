<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enes Threat Intel</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&family=VT323&display=swap" rel="stylesheet">

    <style>
        /* --- GENEL AYARLAR --- */
        :root {
            --bg-color: #050505;
            --panel-bg: rgba(10, 10, 10, 0.90);
            --neon-green: #00ff41;
            --neon-purple: #bc13fe;
            --neon-red: #ff3333;
        }

        body {
            background-color: var(--bg-color);
            color: var(--neon-green);
            font-family: 'Share Tech Mono', monospace;
            margin: 0; padding: 0;
            overflow-x: hidden;
            font-size: 15px; /* Font boyutu idealle≈ütirildi */
        }

        canvas#matrix {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
        }

        /* --- RGB NEON ANƒ∞MASYONU --- */
        @keyframes rgb-cycle {
            0% { border-color: var(--neon-green); box-shadow: 0 0 8px rgba(0, 255, 65, 0.2); color: var(--neon-green); }
            50% { border-color: var(--neon-purple); box-shadow: 0 0 15px rgba(188, 19, 254, 0.3); color: var(--neon-purple); }
            100% { border-color: var(--neon-green); box-shadow: 0 0 8px rgba(0, 255, 65, 0.2); color: var(--neon-green); }
        }

        /* --- HEADER --- */
        .header-container {
            text-align: center; padding: 25px 0 15px 0; /* Padding azaltƒ±ldƒ± */
            background: linear-gradient(to bottom, rgba(0,0,0,0.95), rgba(0,0,0,0.1));
            position: relative; z-index: 10;
        }

        .cyber-eye {
            width: 80px; height: 80px; border-radius: 50%; /* Logo k√º√ß√ºlt√ºld√º */
            border: 3px solid var(--neon-green);
            animation: rgb-cycle 4s infinite alternate;
            background: #000;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            margin: 10px 0 5px 0; letter-spacing: 4px;
            text-transform: uppercase; font-size: 2.2em; /* Ba≈ülƒ±k k√º√ß√ºlt√ºld√º */
            text-shadow: 0 0 10px currentColor;
            animation: rgb-cycle 4s infinite alternate;
        }

        p.subtitle {
            font-family: 'VT323', monospace; font-size: 1.2em;
            color: #ccc; letter-spacing: 2px; margin: 0;
        }

        /* --- DASHBOARD --- */
        .dashboard {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 30px; padding: 30px; /* Bo≈üluklar azaltƒ±ldƒ± */
            max-width: 1200px; margin: 0 auto; /* Geni≈ülik kƒ±sƒ±tlandƒ± */
            position: relative; z-index: 5;
        }

        @media (max-width: 900px) { .dashboard { grid-template-columns: 1fr; } }

        .panel {
            background: var(--panel-bg);
            border: 1px solid var(--neon-green);
            border-radius: 8px; padding: 25px; /* ƒ∞√ß bo≈üluk azaltƒ±ldƒ± */
            backdrop-filter: blur(8px);
            animation: rgb-cycle 6s infinite alternate;
        }

        h2.panel-title {
            margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px;
            font-family: 'Orbitron', sans-serif; color: #fff;
            font-size: 1.4em;
        }

        /* --- INPUT & BUTTON --- */
        input, select {
            width: 100%; padding: 10px; margin: 8px 0; /* Daha zarif inputlar */
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #555; color: #fff;
            font-family: 'Share Tech Mono', monospace; font-size: 1em;
            box-sizing: border-box; transition: 0.3s;
        }
        input:focus { border-color: #fff; outline: none; box-shadow: 0 0 10px rgba(255,255,255,0.2); }

        button {
            width: 100%; padding: 12px; margin-top: 10px;
            background: rgba(0, 0, 0, 0.7); border: 1px solid;
            font-family: 'Orbitron', sans-serif; font-size: 1em;
            cursor: pointer; letter-spacing: 1px; text-transform: uppercase;
            animation: rgb-cycle 3s infinite alternate; transition: 0.2s; font-weight: bold;
        }
        button:hover { background: rgba(255, 255, 255, 0.15); box-shadow: 0 0 20px currentColor; transform: scale(1.01); }

        /* --- SONU√á Lƒ∞STESƒ∞ --- */
        #manualResultArea, #result-area {
            margin-top: 15px; max-height: 400px; overflow-y: auto;
            border-top: 1px solid #333; padding-top: 10px;
        }

        .result-item {
            background: rgba(255,255,255,0.04);
            border-left: 3px solid #333;
            padding: 10px 15px; margin-bottom: 8px;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.95em;
            overflow: hidden; /* Ta≈ümayƒ± engelle */
        }
        .result-item:hover { border-left-color: var(--neon-purple); background: rgba(188, 19, 254, 0.15); }

        /* --- URL KESME (Ellipsis) --- */
        .url-content {
            font-weight: bold;
            color: #00ff41;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 60%;
        }

        .tag-container {
            min-width: 140px; text-align: right; flex-shrink: 0;
        }

        .tag {
            font-size: 0.8em; padding: 3px 8px;
            background: #000; border: 1px solid #555;
            margin-left: 5px; color: #ccc;
            font-weight: bold;
        }

        /* --- MODAL --- */
        .modal {
            display: none; position: fixed; z-index: 9999; left: 0; top: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.92);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: #0d0d0d; border: 2px solid var(--neon-red);
            margin: 10% auto; padding: 30px; width: 90%; max-width: 450px;
            box-shadow: 0 0 40px rgba(255, 51, 51, 0.2);
            text-align: center; position: relative;
        }

        /* --- FOOTER --- */
        footer {
            text-align: center; padding: 20px; color: #666; font-size: 0.8em;
            background: rgba(0,0,0,0.95); position: relative; z-index: 10;
        }

        .score-high { color: var(--neon-green); font-weight: bold; font-size: 1.2em; }
        .score-med { color: yellow; font-weight: bold; font-size: 1.2em; }
        .score-low { color: var(--neon-red); font-weight: bold; font-size: 1.2em; }
    </style>
</head>
<body>

    <canvas id="matrix"></canvas>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <span style="position:absolute; top:15px; right:20px; cursor:pointer; font-size:24px; color:#fff;" onclick="closeModal()">‚úï</span>
            <h2 style="color:var(--neon-red); font-family:'Orbitron'; font-size: 1.6em;">‚ö†Ô∏è MANUEL Gƒ∞Rƒ∞≈û</h2>
            <p style="color:#aaa; font-size: 1em;">Veritabanƒ±na yeni tehdit ekleniyor.</p>
            <hr style="border-color:#333; margin-bottom:20px;">

            <input type="text" id="newUrl" placeholder="Zararlƒ± URL (√ñrn: http://fake.com)">
            <input type="text" id="newTarget" placeholder="Hedef (√ñrn: Banka)">
            <select id="newStatus">
                <option value="ONLINE">ONLINE (Aktif)</option>
                <option value="OFFLINE">OFFLINE (Pasif)</option>
            </select>
            <button onclick="submitNewSite()" style="border-color:var(--neon-red); color:var(--neon-red); animation:none;">VERƒ∞TABANINA KAYDET</button>
        </div>
    </div>

    <div class="header-container">
        <img src="/static/logo.jpg" alt="Cyber Eye" class="cyber-eye">
        <h1>PHISHING INTELLIGENCE</h1>
        <p class="subtitle">ADVANCED THREAT DETECTION SYSTEM</p>
    </div>

    <div class="dashboard">

        <div class="panel">
            <h2 class="panel-title">üõ°Ô∏è YAPAY ZEKA TARAYICI</h2>
            <p style="color:#999; font-size: 0.9em;">URL'yi girin, 3 katmanlƒ± g√ºvenlik motoru analiz etsin.</p>

            <input type="text" id="manualUrlInput" placeholder="https://...">
            <button onclick="checkManualURL()">Sƒ∞STEMƒ∞ BA≈ûLAT</button>

            <div id="manualResultArea" style="display:none;">
                <div id="scoreText">...</div>
                <div id="riskText" style="color:#fff; margin:10px 0; font-size:1em;">...</div>
                <ul id="detailsList" style="padding-left:0; list-style:none; font-size:0.95em;"></ul>
            </div>
        </div>

        <div class="panel">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333; padding-bottom:10px;">
                <h2 style="margin:0; font-family:'Orbitron'; color:#fff; font-size:1.4em;">üóÑÔ∏è TEHDƒ∞T AKI≈ûI</h2>
                <button onclick="openModal()" style="width:auto; padding:8px 15px; font-size:0.8em; margin:0;">+ EKLE</button>
            </div>

            <div style="display:flex; gap:10px; margin-top:15px;">
                <input type="text" id="urlInput" placeholder="Ara..." style="flex:2;">
                <select id="limitSelect" style="flex:1;">
                    <option value="10">10</option>
                    <option value="20" selected>20</option>
                    <option value="50">50</option>
                </select>
            </div>
            <button onclick="searchData()" style="margin-top:8px;">SORGULA</button>

            <div style="margin:10px 0; font-size:0.9em; color:#888;">
                Toplam Kayƒ±t: <span id="total-count" style="color:#fff; font-weight:bold;">...</span>
            </div>

            <div id="loading" style="display:none; color:yellow; font-size:1em;">Veri √áekiliyor...</div>
            <div id="result-area"></div>
        </div>

    </div>

    <footer>
        <p class="neon-text">SYSTEM SECURE | DATABASE CONNECTED | MADE BY ENES</p>
    </footer>

    <script>
        // MATRIX ANIMATION
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const alphabet = '„Ç¢„Ç°„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É£„É©„ÉØ„Ç¨„Ç∂„ÉÄ„Éê„Éë„Ç§„Ç£„Ç≠„Ç∑„ÉÅ„Éã„Éí„Éü„É™„É∞„ÇÆ„Ç∏„ÉÇ„Éì„ÉîABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const rainDrops = [];
        for(let x = 0; x < columns; x++) rainDrops[x] = 1;

        const draw = () => {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0F0';
            ctx.font = fontSize + 'px monospace';
            for(let i = 0; i < rainDrops.length; i++) {
                const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
                ctx.fillText(text, i * fontSize, rainDrops[i] * fontSize);
                if(rainDrops[i] * fontSize > canvas.height && Math.random() > 0.975) rainDrops[i] = 0;
                rainDrops[i]++;
            }
        };
        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
        setInterval(draw, 35);

        // API FONKSƒ∞YONLARI
        window.onload = function() { fetchStats(); loadLatest(); };
        function openModal() { document.getElementById("addModal").style.display = "block"; }
        function closeModal() { document.getElementById("addModal").style.display = "none"; }
        window.onclick = function(e) { if(e.target == document.getElementById("addModal")) closeModal(); }

        async function submitNewSite() {
            const url = document.getElementById("newUrl").value;
            const target = document.getElementById("newTarget").value;
            const status = document.getElementById("newStatus").value;
            if (!url || !target) { alert("Eksik bilgi!"); return; }
            try {
                const res = await fetch('/api/add-site', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, target, status })
                });
                if(res.ok) { alert("Eklendi!"); closeModal(); loadLatest(); fetchStats(); }
                else alert("Hata!");
            } catch(e) { alert("Sunucu hatasƒ±"); }
        }

        async function checkManualURL() {
            const url = document.getElementById("manualUrlInput").value;
            const resultArea = document.getElementById("manualResultArea");
            const scoreText = document.getElementById("scoreText");
            const riskText = document.getElementById("riskText");
            const detailsList = document.getElementById("detailsList");

            if(!url) return;
            resultArea.style.display = "block";
            scoreText.innerText = "ANALƒ∞Z EDƒ∞Lƒ∞YOR...";
            scoreText.className = ""; detailsList.innerHTML = "";

            try {
                const res = await fetch('/api/check-url', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                const data = await res.json();

                scoreText.innerText = `SKOR: %${data.score}`;
                scoreText.className = data.score >= 80 ? "score-high" : (data.score >= 50 ? "score-med" : "score-low");
                riskText.innerHTML = `DURUM: ${data.risk_level}`;

                if(data.sources) detailsList.innerHTML += `<div style='font-size:0.8em; color:#888; margin-bottom:10px;'>${data.sources.map(s=>s.name).join(', ')}</div>`;
                data.details.forEach(item => {
                    const li = document.createElement("li");
                    li.style.marginBottom = "5px";
                    if(item.includes("Tehlikeli") || item.includes("yok") || item.includes("HTTPS")) {
                        li.innerText = `‚ùå ${item}`; li.style.color = "#ff3333";
                    } else if (item.includes("G√ºvenilir")) {
                        li.innerText = `‚úÖ ${item}`; li.style.color = "#00ff41";
                    } else {
                        li.innerText = `‚ö†Ô∏è ${item}`; li.style.color = "yellow";
                    }
                    detailsList.appendChild(li);
                });
            } catch(e) { scoreText.innerText = "HATA"; }
        }

        async function fetchStats() {
            try {
                const res = await fetch('/stats/');
                const data = await res.json();
                document.getElementById('total-count').innerText = data.toplam_zararli_site;
            } catch(e) {}
        }

        async function loadLatest() {
            const limit = document.getElementById('limitSelect').value;
            try {
                const res = await fetch(`/latest/?limit=${limit}`);
                const data = await res.json();
                renderList(data.data);
            } catch(e) {}
        }

        async function searchData() {
            const input = document.getElementById('urlInput').value;
            const limit = document.getElementById('limitSelect').value;
            if(!input || input.length < 3) { loadLatest(); return; }

            document.getElementById("loading").style.display = "block";
            document.getElementById("result-area").innerHTML = "";
            try {
                const res = await fetch(`/check/?url=${encodeURIComponent(input)}&limit=${limit}`);
                const data = await res.json();
                document.getElementById("loading").style.display = "none";
                data.status === 'SAFE' ? document.getElementById("result-area").innerHTML = "<div style='padding:20px; text-align:center; color:#00ff41; border:1px solid #00ff41; font-size:1.1em;'>TEMƒ∞Z ‚úÖ</div>" : renderList(data.data);
            } catch(e) {}
        }

        function renderList(items) {
            const area = document.getElementById("result-area");
            area.innerHTML = "";
            items.forEach(item => {
                let statusUpper = item.status.toUpperCase();
                let displayStatus = "OFFLINE";
                if(statusUpper === 'ACTIVE' || statusUpper === 'VALID' || statusUpper === 'ONLINE') {
                    displayStatus = "ONLINE";
                }

                const statusColor = displayStatus === 'ONLINE' ? '#ff3333' : '#666';

                area.innerHTML += `
                    <div class="result-item">
                        <div class="url-content">${item.url}</div>
                        <div class="tag-container">
                            <span class="tag">${item.target}</span>
                            <span class="tag" style="color:${statusColor}; border-color:${statusColor}">${displayStatus}</span>
                        </div>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>
